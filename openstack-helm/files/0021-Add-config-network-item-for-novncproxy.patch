From 6fba31f6ba8627c7314a46f5b54d59fd17858848 Mon Sep 17 00:00:00 2001
From: zhipengl <zhipengs.liu@intel.com>
Date: Wed, 4 Sep 2019 13:24:12 +0800
Subject: [PATCH] Patch21: 0021-Add-config-network-item-for-novncproxy.patch

Signed-off-by: zhipengl <zhipengs.liu@intel.com>
---
 nova/templates/deployment-novncproxy.yaml | 2 ++
 nova/values.yaml                          | 2 ++
 2 files changed, 4 insertions(+)

diff --git a/nova/templates/deployment-novncproxy.yaml b/nova/templates/deployment-novncproxy.yaml
index 2611ba8..1eebcfd 100644
--- a/nova/templates/deployment-novncproxy.yaml
+++ b/nova/templates/deployment-novncproxy.yaml
@@ -52,8 +52,10 @@ spec:
 {{ tuple $envAll "nova" "novnc-proxy" | include "helm-toolkit.snippets.kubernetes_pod_anti_affinity" | indent 8 }}
       nodeSelector:
         {{ .Values.labels.novncproxy.node_selector_key }}: {{ .Values.labels.novncproxy.node_selector_value }}
+{{- if .Values.pod.useHostNetwork.novncproxy }}
       hostNetwork: true
       dnsPolicy: ClusterFirstWithHostNet
+{{- end }}
       initContainers:
 {{ tuple $envAll "novncproxy" $mounts_nova_novncproxy_init | include "helm-toolkit.snippets.kubernetes_entrypoint_init_container" | indent 8 }}
         - name: nova-novncproxy-init
diff --git a/nova/values.yaml b/nova/values.yaml
index ee00591..db86621 100644
--- a/nova/values.yaml
+++ b/nova/values.yaml
@@ -2050,6 +2050,8 @@ pod:
       nova_spiceproxy:
         volumeMounts:
         volumes:
+  useHostNetwork:
+    novncproxy: true
   replicas:
     api_metadata: 1
     compute_ironic: 1
-- 
1.8.3.1

